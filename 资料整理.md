####  0506 springboot  springcloud

#####  自动配置原理/启动原理

@springboot Application 下有三个注解



@Confinature

 @EnableAutoConfiguration

@ compoentscan 



 引入了EnableAutoConfigurationImportSelector 类, 引入

@ configration

 @EnableConfigurationProperties(HttpEncodingProperties.class)

预先将属性添加到spring容器中,实现了自动配置 

#####  常用注解

@springbootApplication  

@enableAutoConfigration 

@servcie    @value @component 

##### 单元测试

  @RunWith(SpringRunner.class) 

  @SpringBootTest    

##### 禁用特定的自动配置类**  

exclude = 

#####  **什么是Spring boot  Actuator？它有什么优势？**  

  提供了web接口,允许我们对生产环境中的应用程序进行监视和管理。 

 

#####  spring Boot 热部署

 [maven 插件 springloaded](https://blog.csdn.net/xiaojin21cen/article/details/88312873#maven__springloaded_2) 

 [依赖 spring-boot-devtools 热部署模块](https://blog.csdn.net/xiaojin21cen/article/details/88312873#__springbootdevtools__52) 

####  springcloud 

#####  五大组件

  Eureka 服务发现

  ribbon  负载均衡

  hystrix  断路器

  zuul      服务网关 

  

  spring cloud config 分布式配置

#####  微服务的优缺点 

1 . 开发效率高/  低耦合, 面向接口编程,  易于第三方集成, 可以用不同的语言编写.灵活

2 .  保持数据一致性困难, 服务通信成本高, 性能监控困难





 



#### es面试题整理

##### es底层 

 lucene 包含各种倒索引算法 

##### 倒排索引
 搜索引擎中,每个文档都有一个文档对应的id, 文档内容被表示为一系列关键词的集合。例如，文档 1 经过分词，提取了 20 个关键词，每个关键词都会记录它在文档中出现的次数和出现位置。

倒排索引就是关键词到文档 ID 的映射，每个关键词都对应着一系列的文件，这些文件中都出现了关键词。 

##### es的mapping

映射（mapping）
映射是定义一个文档以及其所包含的字段如何被存储和索引的方法。

例如，用映射来定义以下内容：

  哪些 string 类型的 field 应当被当成当成 full-text 字段
  哪些字段应该是数值类型、日期类型或者是地理位置信息
  日期类型字段的格式是怎么样的
  是否文档的所有字段都需要被索引到 _all 字段
  动态增加的 field 可以由用户自定义的模板来控制其行为

##### esmapping的数据类型

boolean,string ,byte,short  integer float double 

 date

##### es性能优化 

1. 索引效率优化 

   批量提交, 优化硬件,  增加refresh 写入时间间隔,减少副本数量 (默认3

2. 查询效率优化

   避免大分页, 一次小分页

3. jvm 设置

 不要超过32G
  不要把内存全部给 堆内存

 

##### es读数据

  可以通过 `doc id` 来查询，会根据 `doc id` 进行 hash，判断出来当时把 `doc id` 分配到了哪个 shard 上面去，从那个 shard 去查询。 

 客户端发送请求到任意一个 node，成为 `coordinate node`。 

 `coordinate node` 对 `doc id` 进行哈希路由，将请求转发到对应的 node，此时会使用 `round-robin`随机轮询算法，在 `primary shard` 以及其所有 replica 中随机选择一个，让读请求负载均衡。 

 接收请求的 node 返回 document 给 `coordinate node`。

 `coordinate node` 返回 document 给客户端。  

##### es 写数据过程

  客户端选择一个 node 发送请求过去，这个 node 就是 `coordinating node`（协调节点）。 

 `coordinating node` 对 document 进行路由，将请求转发给对应的 node（有 primary shard） 

 实际的 node 上的 `primary shard` 处理请求，然后将数据同步到 `replica node` 

 `coordinating node` 如果发现 `primary node` 和所有 `replica node` 都搞定之后，就返回响应结果给客户端。 